name: Main App Workflow

on:
  pull_request:
    paths:
      - ./github/workflows/app-workflow.yml
      - app/**

jobs:
    build:
      runs-on: ubuntu-latest

      strategy:
        matrix:
          module: [app, currency-app]
        
      steps:
        - name: Set up JDK 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'adopt'
            
        - name: Build with Gradle for ${{ matrix.module }}
          working-directory: ${{ matrix.module }}
          run: ./gradlew :${{ matrix.module }}:build
          
        - name: Run tests for ${{ matrix.module }}
          working-directory: ${{ matrix.module }}
          run: ./gradlew :${{ matrix.module }}:test
          
        - name: Calculate test coverage for ${{ matrix.module }}
          working-directory: ${{ matrix.module }}
          run: ./gradlew :${{ matrix.module }}:jacocoTestReport

